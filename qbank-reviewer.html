<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Bank Reviewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 400;
        }

        .question-block {
            margin-bottom: 50px;
            padding: 30px;
            border: 1px solid #333;
            border-radius: 4px;
        }

        .question-number {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question-stem {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .comment-section {
            margin: 10px 0 20px 0;
            padding: 10px;
            background-color: #111;
            border-left: 2px solid #444;
        }

        .comment-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment-label::before {
            content: 'üí¨';
            font-size: 14px;
        }

        textarea {
            width: 100%;
            background-color: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
            border-radius: 3px;
            padding: 8px;
            font-size: 13px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }

        textarea:focus {
            outline: none;
            border-color: #555;
        }

        .answers {
            margin: 20px 0;
        }

        .answer-option {
            margin: 10px 0;
            padding: 10px;
            cursor: pointer;
            border-radius: 3px;
            transition: background-color 0.2s;
        }

        .answer-option:hover {
            background-color: #1a1a1a;
        }

        .answer-option input[type="radio"] {
            margin-right: 10px;
            cursor: pointer;
        }

        .answer-option label {
            cursor: pointer;
            display: inline;
        }

        .image-container {
            margin: 20px 0;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #333;
            border-radius: 3px;
        }

        .note {
            margin: 15px 0;
            padding: 10px;
            background-color: #1a1a1a;
            border-left: 3px solid #666;
            font-size: 14px;
            font-style: italic;
        }

        .controls {
            position: sticky;
            top: 20px;
            background-color: #000;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 4px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            background-color: #222;
            color: #fff;
            border: 1px solid #444;
            padding: 12px 24px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        button:hover {
            background-color: #333;
            border-color: #555;
        }

        button:active {
            background-color: #1a1a1a;
        }

        .save-status {
            color: #888;
            font-size: 12px;
            text-align: center;
            margin-top: 10px;
        }

        .save-status.saved {
            color: #4a4;
        }

        .progress {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-bottom: 10px;
        }

        @media print {
            body {
                background-color: #fff;
                color: #000;
            }
            .controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ultrasound Question Bank Review</h1>

        <div class="controls">
            <button onclick="saveData()">üíæ Save Progress</button>
            <button onclick="exportData()">üìß Email to Christian</button>
            <button onclick="clearData()">üóëÔ∏è Clear All Comments</button>
            <div style="width: 100%; text-align: center;">
                <div class="save-status" id="saveStatus">Auto-saving enabled</div>
                <div class="progress" id="progress"></div>
            </div>
        </div>

        <div id="questions"></div>
    </div>

    <script>
        const questions = [
            {
                number: 1,
                stem: "A 4 y/o hemodynamically stable male presents with cough, fevers and congestion for 2 days, you perform the ultrasound, what is the next best step in management",
                answers: [
                    "A. Antibiotics",
                    "B. CXR",
                    "C. Transfer to children",
                    "D. Tylenol and d/c"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1660318530325-P9UBT29O9YR3PBCRGYBJ/image-asset.gif?format=300w"
            },
            {
                number: 2,
                stem: "Which of the following is NOT associated with the below clip",
                answers: [
                    "A. Increased risk of torsion",
                    "B. Chronic pain",
                    "C. Presence of free fluid in the abdomen",
                    "D. Increased prevalence in reproductive age"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1607200672734-Y4TG74ED7Z7PBJ73XWZ0/image-asset.gif?format=500w"
            },
            {
                number: 3,
                stem: "At what gestational age can you reliably visualize a fetal pole with cardiac activity on transvaginal ultrasound? (Assume normal viable intrauterine pregnancy)",
                answers: [
                    "A. 4-5 weeks",
                    "B. 5.5-6 weeks",
                    "C. 7-8 weeks",
                    "D. 9-10 weeks"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1720554061163-UTEU446DV5FSBC5Z61LQ/image-asset.gif?format=300w"
            },
            {
                number: 4,
                stem: "What is the likely complaint of the following patient",
                answers: [
                    "A. Painful arm rotation",
                    "B. Headache",
                    "C. Back Pain",
                    "D. Fracture"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/5bc94f5b9b7d1515843688af/1616937880006-PGQRLVROBBY2CVU3A8Y7/n.png?format=2500w",
                note: "Giant cell arteritis"
            },
            {
                number: 5,
                stem: "What is the most likely diagnosis, and which additional ultrasound finding would make you MOST concerned?",
                answers: [
                    "A. Ectopic pregnancy; presence of yolk sac in adnexal mass",
                    "B. Ectopic pregnancy; moderate to large free fluid in Morrison's pouch",
                    "C. Heterotopic pregnancy; absent cardiac activity in IUP",
                    "D. Corpus luteum cyst; complex echogenic appearance"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1706570866137-EE4Q4LKJK92SV4GY7C0B/image-asset.gif?format=750w"
            },
            {
                number: 6,
                stem: "A 78 y/o female on plavix presents with vision changes you perform the following ultrasound what is your next step in management?",
                answers: [
                    "A. Lateral Canthotomy",
                    "B. Stop plavix and d/w Optho",
                    "C. Neurology consult",
                    "D. Possible Thrombolytic therapy and optho consult"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1514856196906-FUG64OLXYMGE9IMGE8NE/Central+Retinal+Artery+Occlusion+venous+flow+-+Schechter.gif?format=2500w"
            },
            {
                number: 7,
                stem: "Based on the ultrasound findings what is the most appropriate referral timeframe?",
                answers: [
                    "A. Emergent - same day (within 6 hours)",
                    "B. Urgent - within 24 hours",
                    "C. Semi-urgent - within 1 week",
                    "D. Routine - within 2-4 weeks"
                ]
            },
            {
                number: 8,
                stem: "A 70 y/o male presents with mild abdominal pain and stable vital signs. What is the most likely cause of the findings seen?",
                answers: [
                    "A. Perforated Viscous",
                    "B. Prior Surgical procedure",
                    "C. Acute cholecystitis",
                    "D. Mesenteric Ischemia"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1567013645799-IIBASIEONI3N68X3IYZC/pneumobilia.gif?format=2500w"
            },
            {
                number: 9,
                stem: "The region where the ultrasound beam converges before diverging is called the _____ and its length is determined by _____",
                answers: [
                    "A. Fresnel zone; transducer frequency and diameter",
                    "B. Fraunhofer zone; pulse repetition frequency",
                    "C. Focal zone; gain settings",
                    "D. Near field; time-gain compensation"
                ]
            },
            {
                number: 10,
                stem: "All of the following are ultrasonographic signs of AAA rupture except",
                answers: [
                    "A. Turbulent Flow",
                    "B. Disruptions of calcifications in the wall",
                    "C. Depression of the psoas muscle",
                    "D. Surrounding free fluid",
                    "E. All of the above are true"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1617893937647-54ZZ3JZ55YZ2S4D0DXHA/image-asset.gif?format=500w"
            },
            {
                number: 11,
                stem: "The artifact seen in this clip is called ______ and is due to _____ of sound waves",
                answers: [
                    "A. Posterior Acoustic enhancement, low attenuation",
                    "B. Side lobe, low attenuation",
                    "C. Posterior acoustic enhancement, high attenuation",
                    "D. Side lobe, high attenuation"
                ],
                image: "https://www.pocus.org/wp-content/uploads/2023/07/Screenshot-2023-07-23-144616.png"
            },
            {
                number: 12,
                stem: "A 32 y/o female presents with severe lower abdominal pain what is the most sensitive finding of the pathology seen on this clip",
                answers: [
                    "A. Peripheralization of the follicles",
                    "B. Lack of blood flow to the ovary",
                    "C. Enlarged ovary",
                    "D. Free fluid"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1609959738037-49YAZDNSYA07CI8PAFG8/image-asset.gif?format=500w"
            },
            {
                number: 13,
                stem: "Which of the following clips are not suggestive of right sided heart disease",
                answers: [
                    "A. [Image A]",
                    "B. [Image B]",
                    "C. [Image C]",
                    "D. [Image D]"
                ],
                note: "Stimuli of right heart stuff"
            },
            {
                number: 14,
                stem: "A patient presents in cardiac arrest in active compressions what is the next best step in management of this patient",
                answers: [
                    "A. Empiric tissue plasminogen activator (tPA) for massive PE",
                    "B. Immediate pericardiocentesis for cardiac tamponade",
                    "C. Reposition compressions higher on the sternum",
                    "D. Terminate resuscitation - poor prognosis",
                    "E. Continue current management and search for other H's/T's"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1616443665596-8SM6QHLY76QAGMUBV34Y/image-asset.gif?format=500w"
            },
            {
                number: 15,
                stem: "A patient presents with pain to his hand which is the next step in management",
                answers: [
                    "A. Start antibiotics",
                    "B. Emergent surgery",
                    "C. Splint",
                    "D. Foreign body removal"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1554692613487-GL7ES4Y1OBRHFT0YO3BV/necrotizing+fasciitis+.gif?format=500w"
            },
            {
                number: 16,
                stem: "Approximately how many standard single-use ultrasound gel packets could fit inside a one of our trauma resuscitation rooms (floor to ceiling, wall to wall) if perfectly packed?",
                answers: [
                    "A. 10,000 packets",
                    "B. 100,000 packets",
                    "C. 1,000,000 packets",
                    "D. 10,000,000 packets"
                ]
            },
            {
                number: 17,
                stem: "Which of the following is most accurate regarding tricuspid annular plane systolic excursion",
                answers: [
                    "A. Less reliable in a patient with a prior inferior myocardial infarct",
                    "B. May be measured using the subxiphoid or apical four view",
                    "C. Measures circumferential right ventricular systolic function",
                    "D. Should not be measured in a patient with an irregular heart beat"
                ]
            },
            {
                number: 18,
                stem: "A patient on anticoagulation presents with blurry vision based on the following ultrasound what is your next step in management (retrobulbar hematoma)",
                answers: [
                    "A. Emergent Optho Evaluation",
                    "B. Lateral Canthotomy",
                    "C. Anticoagulation",
                    "D. CT scans",
                    "E. Eye Shield"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1616116010452-4OI6MM2EOTIOIIPZ5EC1/image-asset.gif?format=500w"
            },
            {
                number: 19,
                stem: "Based on the ultrasound anatomy shown below, what nerve block is being performed?",
                answers: [
                    "A. Serratus Anterior Plane Block",
                    "B. Interscalene Block",
                    "C. Erector Spinae Plane Block",
                    "D. PENG (Pericapsular Nerve Group) Block"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1605815952957-DFQAOMVN5P97IFHIP7SM/image-asset.gif?format=750w"
            },
            {
                number: 20,
                stem: "Based on the ultrasound anatomy shown, what procedure is being performed and what pain will it relieve?",
                answers: [
                    "A. Femoral nerve block - anterior thigh pain",
                    "B. Fascia iliaca block - hip and proximal femur pain",
                    "C. Obturator nerve block - medial thigh pain",
                    "D. Sciatic nerve block - posterior leg pain"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1605665047706-0GS9Z718BYIBOQ90G5KV/image-asset.gif?format=500w"
            },
            {
                number: 21,
                stem: "What is Dan Singer's band's name?",
                answers: [
                    "A. Cool Dude Groovin",
                    "B. The Ultra Gellies",
                    "C. Dude, Where's My Probe?",
                    "D. The Artifacts"
                ]
            },
            {
                number: 22,
                stem: "You perform the following ultrasound. What is true regarding the ultrasound beam as it travels from soft tissue to air?",
                answers: [
                    "A. The Velocity increases",
                    "B. The Pulse duration increases",
                    "C. The Wavelength Decreases",
                    "D. The Frequency Decreases"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1527653744461-9JV9FLATDWL00GOWJIZ3/a+lines+normal.gif?format=500w"
            },
            {
                number: 23,
                stem: "The structure shown in PINK is part of the portal triad. What are the other two structures in this triad?",
                answers: [
                    "A. Hepatic artery and portal vein",
                    "B. Common bile duct and hepatic vein",
                    "C. Cystic duct and hepatic artery",
                    "D. Portal vein and common bile duct"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1567929662896-OVT3GRVKEE6G5FYO7RDA/gallbladder-and-cbd.gif?format=750w"
            },
            {
                number: 24,
                stem: "A 65 y/o with dyspnea on exertion. The M-mode measurement shown is 15 mm. What does this suggest?",
                answers: [
                    "A. Normal LV systolic function (EF >55%)",
                    "B. Mild LV dysfunction (EF 40-50%)",
                    "C. Moderate-severe LV dysfunction (EF <40%)",
                    "D. Diastolic dysfunction with preserved EF"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1680198032131-P2FIQDODZHSKVCF9JZKP/image-asset.gif?format=300w"
            },
            {
                number: 25,
                stem: "You're performing a carotid Doppler study using a 7.5 MHz linear probe at a 60-degree angle. The speed of sound in tissue is 1,540 m/s. Your imaging depth is 4.2 cm. If the pulse repetition frequency (PRF) is 8,000 Hz, and you observe aliasing of blood flow in the internal carotid artery, what is the MINIMUM true peak systolic velocity of blood flow?\n\nFormula: Nyquist Limit (m/s) = (PRF √ó c) / (4 √ó f √ó cos Œ∏)",
                answers: [
                    "A. 0.34 m/s",
                    "B. 0.68 m/s",
                    "C. 1.37 m/s",
                    "D. 2.05 m/s"
                ]
            },
            {
                number: 26,
                stem: "The technique shown would be MOST useful for which clinical scenario?",
                answers: [
                    "A. Evaluating for deep vein thrombosis",
                    "B. Localizing a superficial foreign body",
                    "C. Assessing for pleural effusion",
                    "D. Measuring bladder volume"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1603201414354-M763CKLJBGA2BFY30QZU/image-asset.gif?format=750w"
            },
            {
                number: 27,
                stem: "A trauma patient has the pelvic FAST view shown. Which statement is TRUE regarding this finding?",
                answers: [
                    "A. Negative FAST rules out all intra-abdominal injury",
                    "B. This amount of fluid represents at least 500-1000 mL of hemoperitoneum",
                    "C. Free fluid in pelvis is the most sensitive FAST view",
                    "D. CT is required to confirm this finding before treatment"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1507764822945-I5AIOFVSXHQ8P5FW445E/bowra+pos+fast+trans+bladder.gif?format=300w"
            },
            {
                number: 28,
                stem: "What is the clinical significance of this finding?",
                answers: [
                    "A. Requires immediate anticoagulation - high PE risk",
                    "B. Superficial thrombophlebitis - lower risk than DVT",
                    "C. Requires IVC filter placement",
                    "D. No treatment needed - benign finding"
                ],
                image: "https://images.squarespace-cdn.com/content/v1/58118909e3df282037abfad7/1626288896671-HXRWMPFW1JKWXILXQX1H/image-asset.gif?format=500w"
            }
        ];

        function renderQuestions() {
            const container = document.getElementById('questions');
            const savedData = loadData();

            questions.forEach(q => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-block';
                questionDiv.id = `q${q.number}`;

                let html = `
                    <div class="question-number">Question ${q.number}</div>
                    <div class="question-stem">${q.stem}</div>

                    <div class="comment-section">
                        <div class="comment-label">Comment on question stem</div>
                        <textarea
                            data-question="${q.number}"
                            data-type="stem"
                            placeholder="Your comments on the question...">${savedData[q.number]?.stem || ''}</textarea>
                    </div>

                    <div class="answers">
                `;

                q.answers.forEach((answer, index) => {
                    const answerId = `q${q.number}_a${index}`;
                    const isChecked = savedData[q.number]?.selected === index ? 'checked' : '';
                    html += `
                        <div class="answer-option">
                            <input type="radio"
                                   name="q${q.number}"
                                   id="${answerId}"
                                   value="${index}"
                                   ${isChecked}
                                   onchange="saveData()">
                            <label for="${answerId}">${answer}</label>
                        </div>
                    `;
                });

                html += `</div>
                    <div class="comment-section">
                        <div class="comment-label">Comment on answer choices</div>
                        <textarea
                            data-question="${q.number}"
                            data-type="answers"
                            placeholder="Your comments on the answer choices...">${savedData[q.number]?.answers || ''}</textarea>
                    </div>
                `;

                if (q.image) {
                    html += `
                        <div class="image-container">
                            <img src="${q.image}" alt="Question ${q.number} image" loading="lazy">
                        </div>
                        <div class="comment-section">
                            <div class="comment-label">Comment on image</div>
                            <textarea
                                data-question="${q.number}"
                                data-type="image"
                                placeholder="Your comments on the image...">${savedData[q.number]?.image || ''}</textarea>
                        </div>
                    `;
                }

                if (q.note) {
                    html += `<div class="note">Note: ${q.note}</div>`;
                }

                questionDiv.innerHTML = html;
                container.appendChild(questionDiv);
            });

            // Add event listeners to all textareas
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.addEventListener('input', autoSave);
            });

            updateProgress();
        }

        function loadData() {
            const saved = localStorage.getItem('qbankReview');
            return saved ? JSON.parse(saved) : {};
        }

        function saveData() {
            const data = {};

            questions.forEach(q => {
                data[q.number] = {
                    stem: document.querySelector(`textarea[data-question="${q.number}"][data-type="stem"]`)?.value || '',
                    answers: document.querySelector(`textarea[data-question="${q.number}"][data-type="answers"]`)?.value || '',
                    image: document.querySelector(`textarea[data-question="${q.number}"][data-type="image"]`)?.value || '',
                    selected: null
                };

                const selected = document.querySelector(`input[name="q${q.number}"]:checked`);
                if (selected) {
                    data[q.number].selected = parseInt(selected.value);
                }
            });

            localStorage.setItem('qbankReview', JSON.stringify(data));
            showSaveStatus('Saved!');
            updateProgress();
        }

        let autoSaveTimeout;
        function autoSave() {
            clearTimeout(autoSaveTimeout);
            showSaveStatus('Saving...');
            autoSaveTimeout = setTimeout(() => {
                saveData();
            }, 1000);
        }

        function showSaveStatus(message) {
            const status = document.getElementById('saveStatus');
            status.textContent = message;
            status.className = 'save-status' + (message === 'Saved!' ? ' saved' : '');
        }

        function updateProgress() {
            const data = loadData();
            let answered = 0;
            let commented = 0;

            questions.forEach(q => {
                if (data[q.number]?.selected !== null && data[q.number]?.selected !== undefined) {
                    answered++;
                }
                if (data[q.number]?.stem || data[q.number]?.answers || data[q.number]?.image) {
                    commented++;
                }
            });

            document.getElementById('progress').textContent =
                `Progress: ${answered}/${questions.length} answered ‚Ä¢ ${commented}/${questions.length} with comments`;
        }

        function exportData() {
            const data = loadData();
            let emailBody = 'ULTRASOUND QUESTION BANK REVIEW\n';
            emailBody += '='.repeat(60) + '\n\n';

            questions.forEach(q => {
                emailBody += `QUESTION ${q.number}\n`;
                emailBody += '-'.repeat(60) + '\n';
                emailBody += `Stem: ${q.stem}\n\n`;

                if (data[q.number]?.stem) {
                    emailBody += `[COMMENT ON STEM]\n${data[q.number].stem}\n\n`;
                }

                emailBody += 'Answers:\n';
                q.answers.forEach((answer, index) => {
                    const selected = data[q.number]?.selected === index ? ' ‚úì SELECTED' : '';
                    emailBody += `  ${answer}${selected}\n`;
                });
                emailBody += '\n';

                if (data[q.number]?.answers) {
                    emailBody += `[COMMENT ON ANSWERS]\n${data[q.number].answers}\n\n`;
                }

                if (q.image) {
                    emailBody += `Image: ${q.image}\n`;
                    if (data[q.number]?.image) {
                        emailBody += `[COMMENT ON IMAGE]\n${data[q.number].image}\n`;
                    }
                    emailBody += '\n';
                }

                if (q.note) {
                    emailBody += `Note: ${q.note}\n\n`;
                }

                emailBody += '\n' + '='.repeat(60) + '\n\n';
            });

            // Create mailto link
            const subject = 'Question Bank Review Feedback';
            const mailtoLink = `mailto:christian.treat@stonybrookmedicine.edu?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;

            // Also download as text file
            const blob = new Blob([emailBody], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `qbank_review_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            // Open email client
            window.location.href = mailtoLink;

            showSaveStatus('Export complete! Check your downloads and email client.');
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all comments and selections? This cannot be undone.')) {
                localStorage.removeItem('qbankReview');
                location.reload();
            }
        }

        // Initialize
        renderQuestions();
    </script>
</body>
</html>